@{
    ViewData["Title"] = "Đăng Nhập";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="auth-section">
    <div class="container">
        <div class="auth-card animate-on-scroll">
            <div class="section-title text-center" style="margin-bottom: 30px;">
                <h2>Đăng Nhập</h2>
                <p>Chào mừng bạn quay trở lại!</p>
            </div>

            @* Form đăng nhập chính *@
            <form action="@Url.Action("Login", "Account")" method="post">
                @if (ViewBag.Error != null)
                {
                    <div class="alert alert-danger text-center">@ViewBag.Error</div>
                }

                <div class="form-group">
                    <label>Tài khoản</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user"></i>
                        <input type="text" name="username" placeholder="Nhập tài khoản" required />
                    </div>
                </div>

                <div class="form-group">
    <label>Mật khẩu</label>
    <div class="input-with-icon" style="position: relative; display: flex; align-items: center;">
        <i class="fas fa-lock" style="position: absolute; left: 15px;"></i>
        @* Thêm id="LoginPassword" *@
        <input type="password" name="password" id="LoginPassword" 
               placeholder="Nhập mật khẩu" required 
               style="padding-right: 45px; width: 100%;" />
        
        @* Nút con mắt nằm ở góc phải *@
        <span id="toggleLoginPassword" 
              style="position: absolute; right: 40px; cursor: pointer; color: #888; transition: color 0.3s;">
            <i class="fas fa-eye" id="eyeIconLogin"></i>
        </span>
    </div>
</div>

                <div class="d-grid gap-2 mt-4">
                    <button class="btn btn-primary btn-lg fw-bold" type="submit">
                        ĐĂNG NHẬP NGAY
                    </button>
                </div>
            </form> 
            @* ^^^ Đã đóng form tại đây là đúng ^^^ *@

            <div class="d-flex align-items-center my-4">
                <hr class="flex-grow-1 border-secondary" style="opacity: 0.3;">
                <span class="px-3 text-muted fw-bold text-uppercase small">Hoặc</span>
                <hr class="flex-grow-1 border-secondary" style="opacity: 0.3;">
            </div>

            <div class="d-grid gap-2 mb-3">
                <a asp-action="LoginGoogle" asp-controller="Account"
                    class="btn btn-outline-danger btn-lg d-flex align-items-center justify-content-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-google me-2" viewBox="0 0 16 16">
                        <path d="M15.545 6.558a9.42 9.42 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.689 7.689 0 0 1 5.352-2.082l-2.284 2.284A4.347 4.347 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.792 4.792 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.702 3.702 0 0 0 1.599-2.431H8v-3.08h7.545z" />
                    </svg>
                    Đăng nhập bằng Google
                </a>
            </div>

        </div>

        <div class="auth-links">
            <p>Chưa có tài khoản? <a href="@Url.Action("Register", "Account")">Đăng ký ngay</a></p>
        </div>
        
        @* ĐÃ XÓA: Thẻ </form> thừa ở đây *@
    </div>
    @* ĐÃ XÓA: Thẻ </div> thừa ở đây *@
</section>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const passwordInput = document.querySelector("#LoginPassword");
            const togglePassword = document.querySelector("#toggleLoginPassword");
            const eyeIcon = document.querySelector("#eyeIconLogin");

            if (togglePassword) {
                togglePassword.addEventListener("click", function () {
                    // Chuyển đổi qua lại giữa password và text
                    const isPassword = passwordInput.getAttribute("type") === "password";
                    passwordInput.setAttribute("type", isPassword ? "text" : "password");

                    // Đổi icon con mắt
                    eyeIcon.classList.toggle("fa-eye");
                    eyeIcon.classList.toggle("fa-eye-slash");
                    
                    // Đổi màu để làm nổi bật khi đang hiện mật khẩu
                    this.style.color = isPassword ? "#ff4757" : "#888";
                });
            }
        });
    </script>
}